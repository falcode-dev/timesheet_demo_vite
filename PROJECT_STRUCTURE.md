# プロジェクト構造ドキュメント

## 📁 プロジェクト概要

このプロジェクトは、Dataverse連携タイムシートアプリケーションのフロントエンド実装です。React + TypeScript + Viteで構築され、保守性・拡張性・可読性を重視した設計になっています。

## 🏗️ ディレクトリ構造

```
src/
├── types/              # 型定義管理
├── hooks/              # ビジネスロジック・状態管理
├── utils/              # ユーティリティ関数
├── component/          # 再利用可能UIコンポーネント
├── product/            # 業務固有UIコンポーネント
├── context/            # React Context状態管理
├── api/               # データアクセス層
├── i18n/              # 国際化対応
├── App.tsx            # アプリケーションルート
└── main.tsx           # エントリーポイント
```

---

## 📂 各ディレクトリの詳細

### 🎯 `types/` - 型定義管理
**役割**: アプリケーション全体で使用される型定義を集約・管理

#### ファイル構成
- **`index.ts`** - 共通型定義
  - `WorkOrder`, `Event`, `User`, `Resource`等の基本型
  - `MainTab`, `ViewMode`等のUI状態型
  - `DateTimeRange`, `OptionSet`等のデータ型

- **`components.ts`** - コンポーネントProps型定義
  - `HeaderProps`, `ContentHeaderProps`, `SidebarProps`等
  - 各コンポーネントのインターフェース定義

#### 管理内容
- 型安全性の確保
- インターフェースの一元管理
- コンポーネント間の型整合性

---

### 🔧 `hooks/` - ビジネスロジック・状態管理
**役割**: アプリケーションの状態管理とビジネスロジックを機能別に分割

#### ファイル構成
- **`useAppController.ts`** - アプリケーション統合制御
  - 全体の状態とロジックを統括
  - 各フックの組み合わせと調整

- **`useAppState.ts`** - アプリケーション状態管理
  - 画面状態（タブ、表示モード、日付等）
  - モーダル状態（開閉状態）
  - 選択状態（日時、イベント等）

- **`useTimeEntryActions.ts`** - タイムエントリ操作
  - 作成・更新・削除・複製処理
  - イベントクリック時の詳細取得
  - 新規エントリ作成処理

- **`useModalActions.ts`** - モーダル操作
  - お気に入りタスク保存
  - ユーザーリスト保存

- **`useCalendarController.ts`** - カレンダー操作
  - 前・次・今日ボタンの処理
  - 日付遷移ロジック

- **データ取得系フック**:
  - `useWorkOrders.ts` - 作業指示書データ
  - `useOptionSets.ts` - オプションセットデータ
  - `useEvents.ts` - イベントデータ
  - `useResources.ts` - リソースデータ
  - `useCurrentUser.ts` - 現在ユーザー情報

#### 管理内容
- 状態管理の責任分離
- ビジネスロジックの再利用性
- データ取得とキャッシュ管理

---

### 🛠️ `utils/` - ユーティリティ関数
**役割**: 共通処理・ヘルパー関数の集約

#### ファイル構成
- **`dateFormatter.ts`** - 日付フォーマット処理
  - 今日の日付を日本語形式でフォーマット
  - デフォルト時間範囲の生成

- **`dateUtils.ts`** - 日付操作ユーティリティ
  - UTCからJSTへの変換
  - 日付計算処理

- **`modalHelpers.ts`** - モーダル関連ヘルパー
  - 複製データからイベントオブジェクト生成
  - WorkOrder配列のオプション変換

- **`url.ts`** - URL操作
  - URLパラメータの取得・解析

- **`xrmUtils.ts`** - Dataverse連携
  - Xrmオブジェクトの取得・操作

#### 管理内容
- 共通処理の再利用
- ビジネスロジックとUIロジックの分離
- ユーティリティ関数の一元管理

---

### 🧩 `component/` - 再利用可能UIコンポーネント
**役割**: 原子レベルの再利用可能UIコンポーネント

#### ファイル構成
- **`button/`** - ボタンコンポーネント
  - `Button.tsx` - ボタン実装
  - `Button.css` - ボタンスタイル

- **`input/`** - 入力コンポーネント
  - `Input.tsx` - テキスト入力
  - `Input.css` - 入力スタイル

- **`select/`** - セレクトコンポーネント
  - `Select.tsx` - ドロップダウン選択
  - `Select.css` - セレクトスタイル

- **`tab/`** - タブコンポーネント
  - `Tabs.tsx` - タブ切り替え
  - `Tabs.css` - タブスタイル

- **`textarea/`** - テキストエリアコンポーネント
  - `Textarea.tsx` - 複数行テキスト入力
  - `Textarea.css` - テキストエリアスタイル

#### 管理内容
- 汎用的なUIコンポーネント
- デザインシステムの基盤
- 再利用性の高い部品

---

### 🏢 `product/` - 業務固有UIコンポーネント
**役割**: タイムシートアプリケーション固有のUIコンポーネント

#### ファイル構成
- **`DataverseApp.tsx`** - メインアプリケーション
  - 全体のレイアウト構成
  - コンポーネントの組み合わせ
  - 状態管理の統合

- **`layout/`** - レイアウトコンポーネント
  - `Header.tsx` - アプリヘッダー（タイトル、WorkOrder選択）
  - `ContentHeader.tsx` - 操作ヘッダー（タブ、カレンダー操作）
  - `Sidebar.tsx` - サイドバー（ユーザー検索、お気に入りタスク）
  - `Footer.tsx` - フッター（設定ボタン）

- **`calendar/`** - カレンダー表示
  - `CalendarView.tsx` - カレンダー本体
  - `CalendarView.css` - カレンダースタイル

- **`modal/`** - モーダルコンポーネント
  - `BaseModal.tsx` - ベースモーダル（共通機能）
  - `timeentrymodal/` - タイムエントリ登録・編集
  - `favoritetaskmodal/` - お気に入りタスク管理
  - `userlistmodal/` - ユーザーリスト管理
  - `resourceselectmodal/` - リソース選択
  - `confirmdeletemodal/` - 削除確認

#### 管理内容
- 業務固有のUI実装
- ユーザーインタラクション
- データ表示と操作

---

### 🔄 `context/` - React Context状態管理
**役割**: アプリケーション全体で共有される状態の管理

#### ファイル構成
- **`FavoriteTaskContext.tsx`** - お気に入りタスク管理
  - お気に入りタスクの追加・削除
  - タスクの並び替え・検索

- **`UserListContext.tsx`** - ユーザーリスト管理
  - 許可ユーザー一覧の管理
  - ユーザー選択状態の共有

#### 管理内容
- グローバル状態の管理
- コンポーネント間の状態共有
- 状態の永続化

---

### 🌐 `api/` - データアクセス層
**役割**: Dataverse APIとの通信処理

#### ファイル構成
- **`dataverseClient/`** - Dataverseクライアント
  - `index.ts` - クライアント統合
  - `config/` - 設定管理
  - `core/` - 基底クラス・型定義
  - `clients/` - 各種クライアント
  - 各エンティティ用クライアント（workOrder, timeEntry等）

#### 管理内容
- API通信の抽象化
- データ取得・更新・削除処理
- エラーハンドリング

---

### 🌍 `i18n/` - 国際化対応
**役割**: 多言語対応の管理

#### ファイル構成
- **`index.ts`** - i18n設定
- **`locales/`** - 言語ファイル
  - `en/translation.json` - 英語翻訳
  - `ja/translation.json` - 日本語翻訳

#### 管理内容
- 多言語対応
- 翻訳テキストの管理
- 言語切り替え機能

---

## 🔄 データフロー

### 1. **状態管理フロー**
```
useAppController → useAppState → 各コンポーネント
```

### 2. **データ取得フロー**
```
API → useWorkOrders/useEvents → useAppController → コンポーネント
```

### 3. **ユーザーアクションフロー**
```
UI操作 → useTimeEntryActions → API → 状態更新 → UI更新
```

---

## 🎯 設計原則

### 1. **責任の分離**
- 各ディレクトリが明確な責任を持つ
- 単一責任の原則に従った設計

### 2. **再利用性**
- 汎用コンポーネントの分離
- カスタムフックの機能別分割

### 3. **型安全性**
- TypeScriptによる型チェック
- インターフェースの一元管理

### 4. **保守性**
- 機能別のファイル分割
- 明確な命名規則

### 5. **拡張性**
- プラグイン的な構造
- 新機能追加の容易さ

---

## 📈 パフォーマンス最適化

### 1. **コード分割**
- 機能別のフック分割
- コンポーネントの責任分離

### 2. **状態管理**
- Context APIの適切な使用
- 不要な再レンダリングの防止

### 3. **バンドル最適化**
- 動的インポートの活用
- チャンク分割の最適化

---

この構造により、保守性・拡張性・可読性を兼ね備えた、高品質なアプリケーションを実現しています。
